<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        form {
            max-width: 1000px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border-radius: 8px;
            background-color: #fdfdfd;
            border: 1px solid #dcdcdc;
        }
        .flapper-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        .subsection {
            background-color: #f7f9fb;
            border-left: 3px solid #3498db;
            padding: 10px 15px;
            border-radius: 6px;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: 500;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        button:hover {
            background-color: #2980b9;
        }
        .form-actions {
            text-align: center;
            margin-top: 30px;
        }
        .form-actions button {
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <h1>Settings</h1>
    {% if error %}
      <p style="color:red; text-align:center;">{{ error }}</p>
    {% endif %}
    <form method="POST">
        <div class="section">
            <h2>AWS Settings</h2>
            <label for="aws_access_key_id">Access Key ID:</label>
            <input type="text" id="aws_access_key_id" name="aws_access_key_id" value="{{ config.aws.access_key_id or '' }}">

            <label for="aws_secret_access_key">Secret Access Key:</label>
            <input type="text" id="aws_secret_access_key" name="aws_secret_access_key" value="{{ config.aws.secret_access_key or '' }}">

            <label for="aws_region_name">Region Name:</label>
            <input type="text" id="aws_region_name" name="aws_region_name" value="{{ config.aws.region_name or '' }}">
        </div>

        <div class="section">
            <h2>Scryfall Settings</h2>
            <label for="scryfall_search_url">Scryfall Search URL:</label>
            <input type="text" id="scryfall_search_url" name="scryfall_search_url" value="{{ config.scryfall_search_url or '' }}">
        </div>

        <div class="section">
            <h2>Flapper Settings</h2>
            <div class="flapper-grid">
            {% for flapper, settings in config.flappers.items() %}
            <div class="subsection">
                <h3>{{ flapper|replace('_', ' ')|title }}</h3>
                <label for="{{ flapper }}_open_degrees">Open:</label>
                <input type="text" id="{{ flapper }}_open_degrees" name="{{ flapper }}_open_degrees" value="{{ settings.open_degrees or '' }}">

                <label for="{{ flapper }}_close_degrees">Close:</label>
                <input type="text" id="{{ flapper }}_close_degrees" name="{{ flapper }}_close_degrees" value="{{ settings.close_degrees or '' }}">

                <button type="button" onclick="testFlapper('{{ flapper }}')">Test</button>
            </div>
            {% endfor %}
            </div>
        </div>

        <div class="section">
            <h2>Card Servo Settings</h2>
            <label for="card_servo_open_degrees">Open Degrees:</label>
            <input type="text" id="card_servo_open_degrees" name="card_servo_open_degrees" value="{{ config.card_servo.open_degrees or '' }}">

            <label for="card_servo_close_degrees">Close Degrees:</label>
            <input type="text" id="card_servo_close_degrees" name="card_servo_close_degrees" value="{{ config.card_servo.close_degrees or '' }}">

            <button type="button" onclick="testCardServo()">Test Card Servo</button>
        </div>

        <div class="form-actions">
            <button type="submit" name="save">Save</button>
            <button type="submit" name="cancel">Cancel</button>
        </div>
    </form>

    <script>
        function runScript(scriptName) {
            fetch(`/run_script?script=${encodeURIComponent(scriptName)}`)
                .then(response => response.text())
                .then(data => console.log(`Script ${scriptName} executed:`, data))
                .catch(error => console.error(`Error running ${scriptName}:`, error));
        }

        function testFlapper(flapperName) {
            const baseName = flapperName.replace('flapper_', 'Flapper-');
            runScript(`scripts/${baseName}_Open.py`);
            setTimeout(() => runScript(`scripts/${baseName}_Closed.py`), 2000);
        }

        function testCardServo() {
            runScript("scripts/Card-Release.py");
            setTimeout(() => runScript("scripts/Card-Capture.py"), 2000);
        }
    </script>
</body>
</html>
